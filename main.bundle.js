!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t){t.exports=JSON.parse('{"0":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,0,1,1,1,0,0,0,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,0,1,1,0,0,1,0,0,0,1,1,1,0,0]},"1":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,0,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,1,1,1,1,1,1]},"2":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,1,1,1,0,1,1,0,0,0,1,1,0,0,0,0,1,1,1,0,0,1,1,1,1,0,0,1,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,1,1,1,1]},"3":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,1,1,0,1,1,1,1,1,0]},"4":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,0,0,1,1,1,0,0,0,1,1,1,1,0,0,1,1,0,1,1,0,1,1,0,0,1,1,0,1,1,1,1,1,1,1,0,0,0,0,1,1,0,0,0,0,0,1,1,0]},"5":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,1,1,1,1,0,1,1,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,0,1,1,1,1,1,0]},"6":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,0,1,1,1,1,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,0,1,1,1,1,1,0]},"7":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,1,1,1,1,1,1,1,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0]},"8":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,1,1,0,0,1,1,0,0,0,1,0,1,1,1,0,0,1,0,0,1,1,1,1,0,0,1,0,0,0,0,1,1,1,0,0,0,0,1,1,0,1,1,1,1,1,0]},"9":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,1,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,0,1,1,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,1,1,1,1,0,0]}," ":{"offsetX":-2,"offsetY":0,"width":7,"height":7,"tile":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},".":{"offsetX":0,"offsetY":0,"width":2,"height":7,"tile":[0,0,0,0,0,0,0,0,0,0,1,1,1,1]},":":{"offsetX":0,"offsetY":0,"width":2,"height":7,"tile":[0,0,1,1,1,1,0,0,0,0,1,1,1,1]},";":{"offsetX":0,"offsetY":2,"width":2,"height":7,"tile":[1,1,1,1,0,0,0,0,1,1,0,1,1,0]},"\'":{"offsetX":0,"offsetY":0,"width":2,"height":7,"tile":[1,1,1,1,0,1,0,0,0,0,0,0,0,0]},"\\"":{"offsetX":0,"offsetY":0,"width":5,"height":7,"tile":[1,1,0,1,1,1,1,0,1,1,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},",":{"offsetX":0,"offsetY":2,"width":2,"height":7,"tile":[0,0,0,0,0,0,0,0,1,1,0,1,1,0]},"!":{"offsetX":1,"offsetY":0,"width":2,"height":7,"tile":[1,1,1,1,1,1,1,1,1,1,0,0,1,1]},"?":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,1,1,0,1,1,0,0,1,1,1,1,0,0,1,1,0,0,0,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0]},"_":{"offsetX":0,"offsetY":0,"width":5,"height":7,"tile":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1]},"-":{"offsetX":0,"offsetY":0,"width":5,"height":7,"tile":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},"+":{"offsetX":0,"offsetY":0,"width":5,"height":7,"tile":[0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,1,1,1,1,1,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0]},"=":{"offsetX":0,"offsetY":0,"width":5,"height":7,"tile":[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0]},"*":{"offsetX":0,"offsetY":0,"width":5,"height":7,"tile":[1,0,1,0,1,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0]},"(":{"offsetX":0,"offsetY":-1,"width":3,"height":9,"tile":[0,1,1,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,0,1,1]},")":{"offsetX":0,"offsetY":-1,"width":3,"height":9,"tile":[1,1,0,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,1,1,0]},"A":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,0,1,1,1,0,0,0,1,1,0,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1]},"B":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,1,1,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,0]},"C":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,0,1,1,1,1,0,0,1,1,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,1,1,0,0,1,1,1,1,0]},"D":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,1,1,1,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,1,1,0,1,1,1,1,1,0,0]},"E":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,1,1,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,1,1,1]},"F":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,1,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0]},"G":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,0,1,1,1,1,0,0,1,1,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,1,1,1,1,1,0,0,0,1,1,0,1,1,0,0,1,1,0,0,1,1,1,1,1]},"H":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1]},"I":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,1,1,1,1,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,1,1,1,1,1,1]},"J":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,0,1,1,1,1,1,0]},"K":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,0,0,0,1,1,1,1,0,0,1,1,0,1,1,0,1,1,0,0,1,1,1,1,0,0,0,1,1,1,1,1,0,0,1,1,0,1,1,1,0,1,1,0,0,1,1,1]},"L":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,1,1]},"M":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,0,0,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1]},"N":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,0,0,0,1,1,1,1,1,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,0,1,1]},"O":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,1,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,0,1,1,1,1,1,0]},"P":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,1,1,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0]},"Q":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,1,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,1,1,1,1,1,1,0,0,1,1,0,0,1,1,1,1,0,1]},"R":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,1,1,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,1,1,0,1,1,1,1,1,0,0,1,1,0,1,1,1,0,1,1,0,0,1,1,1]},"S":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,1,1,1,0,1,1,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,1,1,0,1,1,1,1,1,0]},"T":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,1,1,1,1,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0]},"U":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,0,1,1,1,1,1,0]},"V":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,0,0,0,1,1,1,0,0,0,0,0,1,0,0,0]},"W":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,0,0,0,1,1,1,1,0,0,0,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,0,0,1,1]},"X":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,0,0,0,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,0,0,0,1,1,1,0,0,0,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,0,0,0,1,1]},"Y":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[0,1,1,0,0,1,1,0,1,1,0,0,1,1,0,1,1,0,0,1,1,0,0,1,1,1,1,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0]},"Z":{"offsetX":0,"offsetY":0,"width":7,"height":7,"tile":[1,1,1,1,1,1,1,0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,0,1,1,1,1,1,1,1]}}')},function(t,e,i){"use strict";i.r(e);var s=function(){return(s=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};var n,o,r,a,f={debug:!1},c=!1,h=0;function l(){c&&(requestAnimationFrame(l),r=Date.now(),(o=r-n)>24&&(n=r-o%24,f.debug&&console.log(h),a(),h++))}function u(t,e){var i=Object.keys(t).length,s={},n=0;i||e({});var o=function(o){var r=new XMLHttpRequest;r.onload=function(){if(!(r.status>=200&&r.status<300))throw console.error(r.responseText),new Error('Tile "'+o+'" was not found');s[o]=JSON.parse(r.responseText),++n===i&&e(s)},r.open("GET",t[o]),r.send()};for(var r in t)o(r)}function g(t,e){var i={};for(var s in t){var n=t[s];n.endsWith(e)&&(i[s]=n)}return i}function p(t,e,i){function s(t){i(t)}t.load(g(e,".mp3"),(function(){u(g(e,".json"),s)}))}var d=function(){},w=[],v={upPress:d,leftPress:d,downPress:d,rightPress:d,aPress:d,bPress:d,selectPress:d,startPress:d,upRelease:d,leftRelease:d,downRelease:d,rightRelease:d,aRelease:d,bRelease:d,selectRelease:d,startRelease:d,keyDown:d,keyUp:d,reset:function(){v.upPress=d,v.leftPress=d,v.downPress=d,v.rightPress=d,v.aPress=d,v.bPress=d,v.selectPress=d,v.startPress=d,v.upRelease=d,v.leftRelease=d,v.downRelease=d,v.rightRelease=d,v.aRelease=d,v.bRelease=d,v.selectRelease=d,v.startRelease=d,v.keyDown=d,v.keyUp=d},update:function(){for(var t=0,e=w;t<e.length;t++){var i=e[t];v[i]()}w=[]}};document.onkeydown=function(t){switch(t.preventDefault(),t.key){case"w":case"W":case"ArrowUp":w.push("upPress");break;case"d":case"D":case"ArrowRight":w.push("rightPress");break;case"s":case"S":case"ArrowDown":w.push("downPress");break;case"a":case"A":case"ArrowLeft":w.push("leftPress");break;case"j":case"J":case"z":case"Z":w.push("aPress");break;case"k":case"K":case"x":case"X":w.push("bPress");break;case" ":w.push("selectPress");break;case"Enter":w.push("startPress")}t.metaKey||w.push("keyDown")},document.onkeyup=function(t){switch(t.preventDefault(),t.key){case"w":case"W":case"ArrowUp":w.push("upRelease");break;case"d":case"D":case"ArrowRight":w.push("rightRelease");break;case"s":case"S":case"ArrowDown":w.push("downRelease");break;case"a":case"A":case"ArrowLeft":w.push("leftRelease");break;case"j":case"J":case"z":case"Z":w.push("aRelease");break;case"k":case"K":case"x":case"X":w.push("bRelease");break;case" ":w.push("selectRelease");break;case"Enter":w.push("startRelease")}t.metaKey||w.push("keyUp")};var y,m={tracks:{},load:function(t,e){var i=Object.keys(t).length,s=0;function n(){++s===i&&e()}for(var o in i||e(),t){var r=new Audio;this.tracks[o]=r,r.src=t[o],r.oncanplaythrough=n}},play:function(t,e,i){var s=this;void 0===e&&(e=!1),i&&(this.tracks[t].onended=function(){i(),s.tracks[t].onended=null}),this.tracks[t].loop=e,this.tracks[t].play()},pause:function(t){this.tracks[t].pause()},pauseAll:function(){for(var t in this.tracks)this.tracks[t].pause()}},b=function(){return(b=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},x=function(t,e){for(var i=0,s=e.length,n=t.length;i<s;i++,n++)t[n]=e[i];return t},X={},k=!1;function Y(t){t.canvas.clear("static",t.bgColor),Object.values(t.staticSprites).forEach((function(e){e.draw("static",t.canvas)}))}function S(t,e){t.canvas.clear("dynamic"),Object.values(t.animations).forEach((function(t){t.update("dynamic",e)})),Object.values(t.sprites).forEach((function(t){t.draw("dynamic",e)}))}function P(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];y.metaTiles=t,y.init.apply(y,e),Y(y),y.canvas.onResize=function(){y.onResize(),Y(y)},k=!1}function T(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(!X[t])throw new Error('scene "'+t+'" does not exist');k=!0,y&&(y.animations={},y.metaTiles={},y.sprites={},y.staticSprites={},y.controls.reset(),"function"==typeof y.destroy&&y.destroy()),(y=X[t]).changeScene=T,y.preload&&Object.keys(y.preload).length?(f.debug&&console.log("waiting for "+t+" preload..."),p(y.mediaPlayer,y.preload,(function(t){P.apply(void 0,x([t],e))}))):(P.apply(void 0,x([{}],e)),f.debug&&console.log("loaded scene: "+t))}var R=function(){return(R=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function O(t){return void 0===t&&(t={}),R({x:0,y:0,width:0,height:0,centerX:function(t){var e=t.x+t.width/2;this.x=e-this.width/2}},t)}var j=function(){return(j=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function A(t,e){if(t[e])return!0;throw new Error('Font does not contain the character "'+e+'"')}function C(t,e,i,s,n){for(var o=0,r=0,a=e.config.ppp,f=0;f<n.tile.length;f++)1===n.tile[f]&&e.context[t].fillRect((i+o+n.offsetX)*a,(s+r+n.offsetY)*a,a,a),o===n.width-1?(o=0,r++):o++}function E(t,e,i,s,n,o){for(var r=n.split(""),a=i,f=s,c=0;c<r.length;c++){var h=r[c];A(o.font,h)&&(C(t,e,a,f,o.font[h]),a+=o.font[h].width),a+=o.tracking}}function D(t,e,i){for(var s=[],n=t.split(" "),o="",r=0,a=0;a<n.length;a++){for(var f=n[a],c=0,h=0,l=f.split("");h<l.length;h++){var u=l[h];if(A(e.font,u)){var g=e.font[u];c+=g.width+g.offsetX+e.tracking}}(r+=c)<=i?o+=f+" ":(s.push(o),o=f+" ",r=c)}return s.push(o),s}var K=function(){return(K=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function M(t){void 0===t&&(t={});var e=O({width:t.metaTile.width,height:t.metaTile.height}),i=function(t){return void 0===t&&(t={}),j({color:"#06f",rectangle:O(t.rectangle),draw:function(t,e){if(f.debug){console.log("hitBox.draw()");var i=e.config.ppp;e.context[t].globalAlpha=.4,e.context[t].fillStyle=this.color,e.context[t].fillRect(this.rectangle.x*i,this.rectangle.y*i,this.rectangle.width*i,this.rectangle.height*i)}},hit:function(t){return!1}},t)}({rectangle:e});return K({visible:!0,metaTile:null,rectangle:e,hitBox:i,draw:function(t,s){this.visible&&(f.debug&&console.log("metaTileSprite.draw()"),function(t,s){i.rectangle.x=e.x,i.rectangle.x=e.x,i.draw(t,s)}(t,s),function(t,e,i,s,n){var o=0,r=0,a=e.config.ppp,f=n.tiles[n.frame];e.context[t].globalAlpha=1;for(var c=0;c<f.length;c++){var h=f[c];h&&(e.context[t].fillStyle=h,e.context[t].fillRect((i+o)*a,(s+r)*a,a,a)),o===n.width-1?(o=0,r++):o++}}(t,s,this.rectangle.x,this.rectangle.y,this.metaTile))},createAnimation:function(t,e,i,s){var n=this,o=!0,r=!1,a=t,f=0;return{start:function(){o=!0},stop:function(t){t&&(a=t>0?t:e),o=!1},update:function(c,h){f<i?f++:(o&&(a=Math.min(e,++a)),r&&("loop"===s?a=t:"function"==typeof s&&s(),r=!1),f=0),o&&a===e&&(r=!0),n.metaTile.frame=a,n.draw(c,h)}}}},t)}function W(t){void 0===t&&(t={});var e=O({width:t.maxWidth||function(t,e){for(var i=0,s=0,n=t.split("");s<n.length;s++){var o=n[s];if(A(e.font,o)){var r=e.font[o];i+=r.width+r.offsetX+e.tracking}}return i}(t.value,t.options)});return K({color:"#000",value:"",maxWidth:null,visible:!0,options:{font:null,tracking:0,lineHeight:0},rectangle:e,draw:function(t,e){if(this.visible)if(f.debug&&console.log("textSprite.draw()"),e.context[t].fillStyle=this.color,this.maxWidth)for(var i=D(this.value,this.options,this.maxWidth),s=this.rectangle.y,n=0,o=i;n<o.length;n++){var r=o[n];E(t,e,this.rectangle.x,s,r,this.options),s+=this.options.lineHeight}else E(t,e,this.rectangle.x,this.rectangle.y,this.value,this.options)},createAnimation:function(t,e,i,s){var n=this,o=n.value.split("").length,r=0,a=t,c=!1,h=!0;return e=e>0?e:o,{start:function(){h=!0},stop:function(t){t&&(a=t>0?t:o),h=!1},update:function(o,l){if(n.visible)if(l.context[o].fillStyle=n.color,r<i?r++:(h&&(a=Math.min(e,++a)),c&&("loop"===s?a=t:"function"==typeof s&&s(),c=!1),r=0),h&&a===e&&(c=!0),f.debug&&console.log("metaTileSprite.draw()"),n.maxWidth)for(var u=D(n.value,n.options,n.maxWidth),g=n.rectangle.y,p=0,d=0,w=u;d<w.length;d++){var v=w[d];if(!(p+v.length<a)){E(o,l,n.rectangle.x,g,v.slice(0,a-p),n.options),p+=a-p;break}E(o,l,n.rectangle.x,g,v,n.options),p+=v.length,g+=n.options.lineHeight}else E(o,l,n.rectangle.x,n.rectangle.y,n.value.slice(0,a),n.options)}}}},t)}var z={font:i(0),tracking:1,lineHeight:10};function G(t){var e=O({width:t.canvas.config.width});t.staticSprites.controls.rectangle.centerX(e),t.staticSprites.controls.rectangle.y=18,t.sprites.anyKey.rectangle.centerX(e),t.sprites.anyKey.rectangle.y=206}var B={ticksPerBlink:16,tickCount:0,update:function(t){this.tickCount<this.ticksPerBlink?this.tickCount++:(t.sprites.anyKey.visible=!t.sprites.anyKey.visible,this.tickCount=0)}},N={name:"splash",bgColor:"#000",preload:{controls:"src/scenes/assets/splash/controls.json"},init:function(){var t=this;B.tickCount=0,this.controls.keyDown=function(){t.changeScene("title")},this.staticSprites.controls=M({metaTile:this.metaTiles.controls}),this.sprites.anyKey=W({color:"#fff",options:z,value:"PRESS ANY KEY TO CONTINUE"}),G(this)},update:function(){B.update(this)},onResize:function(){G(this)}},U={name:"loading",bgColor:"#000",init:function(){this.sprites.loadingText=W({color:"#fff",options:z,value:"LOADING"});var t=W({color:"#fff",options:z,value:"..."});this.animations.ellipsis=t.createAnimation(0,null,16,"loop");var e=this.canvas.config.height-(this.sprites.loadingText.rectangle.height+16);this.sprites.loadingText.rectangle.x=this.canvas.config.width-(this.sprites.loadingText.rectangle.width+t.rectangle.width+8),this.sprites.loadingText.rectangle.y=e,t.rectangle.x=this.sprites.loadingText.rectangle.x+this.sprites.loadingText.rectangle.width,t.rectangle.y=e}};function H(t){var e=O({width:t.canvas.config.width,height:t.canvas.config.height});t.staticSprites.titleText.rectangle.centerX(e),t.staticSprites.startGame.rectangle.centerX(e),t.staticSprites.about.rectangle.centerX(e),t.staticSprites.copyright.rectangle.centerX(e),t.staticSprites.titleText.rectangle.y=18,t.staticSprites.startGame.rectangle.y=154,t.staticSprites.about.rectangle.y=t.staticSprites.startGame.rectangle.y+19,t.staticSprites.copyright.rectangle.y=e.height-16}var _={index:0,items:["startGame","about"]},L={offsetX:7,offsetY:1,ticksPerBlink:16,tickCount:0,update:function(t,e){this.tickCount<this.ticksPerBlink?this.tickCount++:(t.sprites.cursor.visible=!t.sprites.cursor.visible,this.tickCount=0),t.sprites.cursor.rectangle.x=e.x-t.sprites.cursor.rectangle.width-this.offsetX,t.sprites.cursor.rectangle.y=e.y-this.offsetY}},F={name:"title",bgColor:"#000",preload:{theme:"src/scenes/assets/title/theme.mp3",select:"src/scenes/assets/title/select.mp3",titleText:"src/scenes/assets/title/title-text.json",cursor:"src/scenes/assets/title/cursor.json"},init:function(){var t=this;_.index=0,L.tickCount=0,this.staticSprites.titleText=M({metaTile:this.metaTiles.titleText}),this.staticSprites.startGame=W({color:"#fff",options:z,value:"START GAME"}),this.staticSprites.about=W({color:"#fff",options:z,value:"ABOUT"}),this.staticSprites.copyright=W({color:"#fff",options:z,value:"2021 COSMIC POLYGON"}),H(this),this.sprites.cursor=M({metaTile:this.metaTiles.cursor});var e=function(){m.pauseAll(),m.play("select",!1,(function(){switch(_.index){case 0:console.log(t.changeScene("intro"));break;case 1:console.log(t.changeScene("about"))}}))};this.controls.upPress=function(){_.index>0&&_.index--},this.controls.downPress=function(){_.index<_.items.length-1&&_.index++},this.controls.aPress=function(){e()},this.controls.startPress=function(){e()},m.play("theme",!0)},update:function(){L.update(this,this.staticSprites[_.items[_.index]].rectangle)},onResize:function(){H(this)}},J=function(t){void 0===t&&(t={});var e=s({ppp:1,width:320,height:240},t);function i(t){var i=document.createElement("canvas");i.id=t,i.width=e.width,i.height=e.height,i.style.position="absolute";var s=i.getContext("2d");return s.imageSmoothingEnabled=!1,{element:i,context:s}}var n=i("static"),o=i("dynamic");return document.body.style.margin="0",document.body.style.backgroundColor="#000",document.body.appendChild(n.element),document.body.appendChild(o.element),{element:{static:n.element,dynamic:o.element},context:{static:n.context,dynamic:o.context},config:e,clear:function(t,e){var i=this.config.width,s=this.config.height,n=this.config.ppp;e?(this.context[t].fillStyle=e,this.context[t].fillRect(0,0,i*n,s*n)):this.context[t].clearRect(0,0,i*n,s*n)},getScaleFactor:function(t,e){var i,s=t>e,n=this.config.width>this.config.height;return i=s?n&&this.config.height*(t/this.config.width)<=e?t/this.config.width:e/this.config.height:!n&&this.config.width*(e/this.config.height)<=t?e/this.config.height:t/this.config.width,Math.floor(i)},fitToViewport:function(){var t=window.innerWidth,e=window.innerHeight,i=this.getScaleFactor(t,e);for(var s in this.config.ppp=i,this.element){var n=this.element[s];n.width=this.config.width*i,n.height=this.config.height*i,n.style.top=e/2-n.height/2+"px",n.style.left=t/2-n.width/2+"px"}"function"==typeof this.onResize&&this.onResize()},onResize:null}}();J.fitToViewport(),window.onresize=function(){return J.fitToViewport()},function(t,e,i){for(var s,n=[],o=3;o<arguments.length;o++)n[o-3]=arguments[o];for(var r in t){var a=t[r];a=b(b({},a),{animations:{},canvas:i,config:f,controls:v,metaTiles:{},mediaPlayer:m,sprites:{},staticSprites:{}}),X[r]=a}X.loading&&(s=X.loading).init.apply(s,n),T.apply(void 0,x([e],n))}({loading:U,splash:N,title:F},"splash",J),a=function(){var t;t=J,k?(Y(X.loading),S(X.loading,t)):("function"==typeof y.update&&y.update(t),y.controls.update(),S(y,t))},n=Date.now(),c=!0,l()}]);